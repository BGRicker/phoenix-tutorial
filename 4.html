<html>
	<head>


    <script src="https://code.jquery.com/jquery-1.11.2.js"></script>
    <script src="js/lightbox.min.js"></script>
    <link href="css/lightbox.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="style.css">
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-542ec3e65052d59e" async></script>

    <title>Phoenix Framework: Building an Index Action</title>



    <meta name="description" content="This tutorial will walk you through building the index of a RESTful web application in Elixir and the Phoenix Framework.">
    <link rel="author" href="https://plus.google.com/+KenMazaika"/>
    <link rel="publisher" href="https://plus.google.com/113298058873191273675"/>
    <meta property="og:title" content="A hands-on intro to building modern web applications with Elixir and Phoenix" />

    <meta property="og:type" content="article"/>
    <meta property="og:image" content="og-image.png"/>
    <meta property="og:url" content="http://phoenix.thefirehoseproject.com"/>
    <meta property="og:description" content="The Phoenix Web Framework and Elixir programming language are blowing my mind."/>


    <meta property="fb:admins" content="1818097"/>
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@theFirehoseProject">
<meta name="twitter:creator" content="@kenmazaika">
<meta name="twitter:title" content="A hands-on intro to building modern web applications with Elixir and Phoenix">
<meta name="twitter:description" content="Learn to build a fault tolerant web application with Elixir, Phoenix, Ecto and PostgreSQL..">
<meta name="twitter:image:src" content="og-image.png">



	</head>

	<body>
	<div class="col-xs-10 col-xs-offset-1">
		<h1>Lesson 4</h1>

		<h2>Building an index page</h2>
    <p>
    Let's build a page to list out all the quotes in our application.  In this case we'll use the <code>quote_controller</code> and <code>index</code> action.
    </p>

    <p>
    We're going to build full CRUD functionality on the quotes controller, so we can go ahead and setup the full set of RESTful (or <code>resource</code>ful) routes.
    </p>

    <p>
    Edit <code>web/router.ex</code> and add the following line:
    </p>
<div class="highlight"><pre><span class="k">defmodule</span> <span class="no">Splurty</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
<span class="k">  </span><span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">Router</span>

  <span class="n">pipeline</span> <span class="ss">:browser</span> <span class="k">do</span>
<span class="k">    </span><span class="n">plug</span> <span class="ss">:accepts</span><span class="p">,</span> <span class="err">~</span><span class="n">w</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">plug</span> <span class="ss">:fetch_session</span>
    <span class="n">plug</span> <span class="ss">:fetch_flash</span>
    <span class="n">plug</span> <span class="ss">:protect_from_forgery</span>
  <span class="k">end</span>

  <span class="n">pipeline</span> <span class="ss">:api</span> <span class="k">do</span>
<span class="k">    </span><span class="n">plug</span> <span class="ss">:accepts</span><span class="p">,</span> <span class="err">~</span><span class="n">w</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scope</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="no">Splurty</span> <span class="k">do</span>
<span class="k">    </span><span class="n">pipe_through</span> <span class="ss">:browser</span> <span class="c1"># Use the default browser stack</span>

    <span class="n">get</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="no">QuoteController</span><span class="p">,</span> <span class="ss">:homepage</span>
<div class="emphasis">    <span class="n">resources</span> <span class="s2">&quot;/quotes&quot;</span><span class="p">,</span> <span class="no">QuoteController</span></div>
  <span class="k">end</span>

  <span class="c1"># Other scopes may use custom stacks.</span>
  <span class="c1"># scope &quot;/api&quot;, Splurty do</span>
  <span class="c1">#   pipe_through :api</span>
  <span class="c1"># end</span>
<span class="k">end</span>
</pre></div>

<p>
Save the file.
</p>

<p>
Let's output our routes table and make sure it looks ok.
</p>

  <pre><code>$ mix phoenix.routes</code></pre>

  <p>
  Right now it should say:
  </p>
<pre><code>quote_path  GET     /                 Splurty.QuoteController.homepage/2
quote_path  GET     /quotes           Splurty.QuoteController.index/2
quote_path  GET     /quotes/:id/edit  Splurty.QuoteController.edit/2
quote_path  GET     /quotes/new       Splurty.QuoteController.new/2
quote_path  GET     /quotes/:id       Splurty.QuoteController.show/2
quote_path  POST    /quotes           Splurty.QuoteController.create/2
quote_path  PATCH   /quotes/:id       Splurty.QuoteController.update/2
            PUT     /quotes/:id       Splurty.QuoteController.update/2
quote_path  DELETE  /quotes/:id       Splurty.QuoteController.destroy/2
</code></pre>

<p>
Awesome, it hooked up the full set of resourceful routes.  Sweet.
</p>

<p>
Restart your server.
</p>

<p>
Next up, go into the web browser to the URL that looks like: <a href="http://localhost:4000/quotes/">localhost:4000/quotes</a>.  It complains with the error message: <strong>undefined function: Splurty.QuoteController.index/2</strong>.
</p>
<p>
Since it's mad we don't have the index action in our controller, let's go add one.  Open <code>web/controllers/quote_controller.ex</code> and add the following section:
</p>


<div class="highlight"><pre><span class="k">defmodule</span> <span class="no">Splurty</span><span class="o">.</span><span class="no">QuoteController</span> <span class="k">do</span>
<span class="k">  </span><span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">Controller</span>

  <span class="n">plug</span> <span class="ss">:action</span>

  <span class="k">def</span> <span class="n">homepage</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
<span class="k">    </span><span class="n">render</span> <span class="n">conn</span><span class="p">,</span> <span class="s2">&quot;homepage.html&quot;</span>
  <span class="k">end</span>

<div class="emphasis">  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
<span class="k">    </span><span class="n">render</span> <span class="n">conn</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span>
  <span class="k">end</span></div>  
<span class="k">end</span>
</pre></div>
<p>
Save the file and refresh the page.  It should show you an error message that the template <code>index.html</code> hasn't been created.  This makes sense.
</p>

<p>
Add a file in <code>web/templates/quote/index.html.eex</code> that looks like this:
</p>

<div class="highlight"><pre>YOLO!
</pre></div>
<p>
Save the file, and refresh the page.  Awesome, we no longer see an error message.
</p>

<p>
We want this page to list out each of the quotes in our database, but right now our database has no quotes in it.  Let's jump into iex and add a couple quotes:
</p>

<pre><code>$ iex -S mix</code></pre>


<p>
And add two quotes, running commands like this:
</p>

<pre><code>&gt; quote = %Splurty.Quote{saying: "They hate us, cause they ain't us.", author: "Dave Skylark"}
&gt; Repo.insert(quote)
</code></pre>

<pre><code>&gt; quote2 = %Splurty.Quote{saying: "They're peanut butter and jealous.", author: "Dave Skylark"}
&gt; Repo.insert(quote2)</code></pre>
<p>
Then press CTRL+C twice to exit iex.
</p>

<p>
Cool, now that we have quotes in our database, let's loop through each of them and put them on an HTML table.
</p>

<p>
First thing we'll need to do is load up our quotes in our controller.
Open <code>web/controller/quote_controller.ex</code> and edit the index action to look like this:
</p>

<div class="highlight"><pre><span class="k">defmodule</span> <span class="no">Splurty</span><span class="o">.</span><span class="no">QuoteController</span> <span class="k">do</span>
<span class="k">  </span><span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">Controller</span>

  <span class="n">plug</span> <span class="ss">:action</span>

  <span class="k">def</span> <span class="n">homepage</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
<span class="k">    </span><span class="n">render</span> <span class="n">conn</span><span class="p">,</span> <span class="s2">&quot;homepage.html&quot;</span>
  <span class="k">end</span>

<div class="emphasis">  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span> <span class="k">do</span>
<span class="k">    </span><span class="n">conn</span>
    <span class="o">|&gt;</span> <span class="n">assign</span><span class="p">(</span><span class="ss">:quotes</span><span class="p">,</span> <span class="no">Repo</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="no">Splurty</span><span class="o">.</span><span class="no">Quote</span><span class="p">))</span>
    <span class="o">|&gt;</span> <span class="n">render</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">)</span>
  <span class="k">end</span></div>
<span class="k">end</span>
</pre></div>


<p>
This will render the <code>index.html.eex</code> template on the connection and pass through the assignment of <code>@quotes</code> being all the quotes loaded up.
</p>

<p>
Now edit <code>web/templates/quote/index.html.eex</code> and add the following code:
</p>

<div class="highlight"><pre><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>Saying<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Author<span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">for</span> <span class="n">q</span> <span class="o">&lt;-</span> <span class="vi">@quotes</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">q</span><span class="o">.</span><span class="n">saying</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">q</span><span class="o">.</span><span class="n">author</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;/table&gt;</span>
</pre></div>
<p>
Save the file and open <a href="http://localhost:4000/quotes/">localhost:4000/quotes</a> in your browser.
</p>

<p>
Your application should look
<a href="lesson-4.png" data-lightbox="Lesson 4" data-title="Lesson 4">just like this</a> at this step.
</p>



		<div class="text-center">
		<a href="5.html" class="btn btn-primary">Onward to Lesson 5</a>
		</div>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'thefirehoseprojectelixirphoenix'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
</div>



</div>

    <!--  Google Analytics Tracking Pixel -->
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49340848-1', 'thefirehoseproject.com');
  ga('send', 'pageview');

</script>



	</body>
</html>